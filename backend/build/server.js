(()=>{"use strict";var e={894:function(e,o,i){var n=this&&this.__awaiter||function(e,o,i,n){return new(i||(i=Promise))((function(r,t){function s(e){try{c(n.next(e))}catch(e){t(e)}}function a(e){try{c(n.throw(e))}catch(e){t(e)}}function c(e){var o;e.done?r(e.value):(o=e.value,o instanceof i?o:new i((function(e){e(o)}))).then(s,a)}c((n=n.apply(e,o||[])).next())}))};Object.defineProperty(o,"__esModule",{value:!0});const r=i(611),t=i(437);(0,i(818).config)();const s=process.env.PORT||80,a=process.env.FRONT_URL,c=(0,r.createServer)(),p=new t.Server(c,{cors:{origin:a}}),v={room1:[],room2:[],room3:[],room4:[],room5:[],room6:[],room7:[],room8:[]},u={};p.on("connection",(e=>{e.join("preview"),p.in(e.id).emit("preview",v),e.on("join room",(o=>{o in v&&(e.leave("preview"),e.join(o),e.emit("joined room",o))})),e.on("get initial preview",(()=>{p.in(e.id).emit("initial preview",v)})),e.on("disconnect",(()=>{Object.keys(u).forEach((o=>{delete u[o][e.id]}))})),e.on("leaveroom",(o=>{e.leave(o),e.join("preview")})),e.on("initial shapes",(o=>{p.in(e.id).emit("initial shapes",v[o])})),e.on("new shape",((o,i)=>n(void 0,void 0,void 0,(function*(){v[o]&&(v[o].push(i),e.to(o).emit("add new shape",i),p.in("preview").emit(`update preview ${o}`,i))})))),e.on("broadcast user",((e,{user_id:o,username:i,pos:n,shape:r,color:t})=>{u[e]||(u[e]={}),o&&(u[e][o]={username:i,pos:n,shape:r,color:t}),p.in(e).emit("broadcast users",u[e])}))})),c.listen(s,(()=>{console.log(`Server is running on port ${s}.`)}))},818:e=>{e.exports=require("dotenv")},437:e=>{e.exports=require("socket.io")},611:e=>{e.exports=require("http")}},o={};!function i(n){var r=o[n];if(void 0!==r)return r.exports;var t=o[n]={exports:{}};return e[n].call(t.exports,t,t.exports,i),t.exports}(894)})();